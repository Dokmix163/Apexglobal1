const products = [
  {
    id: 'apexcore-320',
    name: 'ApexCore 320',
    capacity: 320,
    capacityCategory: 'high',
    type: '–°—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å',
    badges: [{ type: 'top', text: '–¢–æ–ø –ø—Ä–æ–¥–∞–∂–∞' }],
    description:
      '–§–ª–∞–≥–º–∞–Ω—Å–∫–∞—è –ª–∏–Ω–∏—è —Å –≤—ã—Å–æ–∫–æ–π –¥–æ–ª–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∞–≥–∏—Å—Ç—Ä–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –≥–æ—Ä–æ–¥—Å–∫–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º.',
    fullDescription:
      'ApexCore 320 ‚Äî —ç—Ç–æ —Ñ–ª–∞–≥–º–∞–Ω—Å–∫–∏–π –∫–æ–º–ø–ª–µ–∫—Å –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –∞—Å—Ñ–∞–ª—å—Ç–æ–±–µ—Ç–æ–Ω–∞ —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é 320 —Ç–æ–Ω–Ω –≤ —á–∞—Å. –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö –º–∞–≥–∏—Å—Ç—Ä–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –≥–æ—Ä–æ–¥—Å–∫–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º —Ä–µ–º–æ–Ω—Ç–∞ –¥–æ—Ä–æ–≥. –ö–æ–º–ø–ª–µ–∫—Å –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–µ—Ü–∏–∑–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—É—é –≥–æ—Ä–µ–ª–∫—É —Å –º–æ–¥—É–ª—è—Ü–∏–µ–π –ø–ª–∞–º–µ–Ω–∏ –∏ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é.',
    features: [
      '–ü—Ä–µ—Ü–∏–∑–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–ª–∞–∂–Ω–æ—Å—Ç–∏',
      '–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –≥–æ—Ä–µ–ª–∫–∞ —Å –º–æ–¥—É–ª—è—Ü–∏–µ–π –ø–ª–∞–º–µ–Ω–∏',
      '–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Ä—É–∫–∞–≤–æ–≤',
      '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ERP –∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞'
    ],
    includes: [
      { icon: '‚öôÔ∏è', text: '–°—É—à–∏–ª—å–Ω—ã–π –±–∞—Ä–∞–±–∞–Ω —Å —Å–∏—Å—Ç–µ–º–æ–π —Ä–µ–∫—É–ø–µ—Ä–∞—Ü–∏–∏' },
      { icon: 'üìä', text: '–°–∏—Å—Ç–µ–º–∞ –¥–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤' },
      { icon: 'üî•', text: '–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –≥–æ—Ä–µ–ª–∫–∞' },
      { icon: 'üåø', text: '–°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø—ã–ª–∏' },
      { icon: 'üíª', text: '–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è' },
      { icon: 'üì¶', text: '–°–∏–ª–æ—Å—ã –¥–ª—è –º–∏–Ω–µ—Ä–∞–ª—å–Ω–æ–≥–æ –ø–æ—Ä–æ—à–∫–∞' }
    ],
    specs: [
      { label: '–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å', value: '320 —Ç/—á' },
      { label: '–ú–æ—â–Ω–æ—Å—Ç—å –≥–æ—Ä–µ–ª–∫–∏', value: '25 –ú–í—Ç' },
      { label: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Å—É—à–∫–∏', value: '–¥–æ 180¬∞C' },
      { label: '–≠–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ', value: '450 –∫–í—Ç' },
      { label: '–ü–ª–æ—â–∞–¥—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏', value: '45√ó25 –º' },
      { label: '–í–µ—Å', value: '280 —Ç' }
    ],
    pdfSpec: '#',
    images: [
      'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=1200&h=800&fit=crop',
      'https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=1200&h=800&fit=crop',
      'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=1200&h=800&fit=crop'
    ]
  },
  {
    id: 'apexflex-210',
    name: 'ApexFlex 210',
    capacity: 210,
    capacityCategory: 'medium',
    type: '–ú–æ–¥—É–ª—å–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å',
    badges: [{ type: 'new', text: '–ù–æ–≤–∏–Ω–∫–∞' }],
    description:
      '–ë—ã—Å—Ç—Ä–æ–≤–æ–∑–≤–æ–¥–∏–º–∞—è –º–æ–¥—É–ª—å–Ω–∞—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤. –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è.',
    fullDescription:
      'ApexFlex 210 ‚Äî –º–æ–¥—É–ª—å–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é 210 —Ç–æ–Ω–Ω –≤ —á–∞—Å. –ë—ã—Å—Ç—Ä–æ–≤–æ–∑–≤–æ–¥–∏–º–∞—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∏–¥–µ–∞–ª—å–Ω–∞ –¥–ª—è —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤. –°–±–æ—Ä–∫–∞ –∏ –≤–≤–æ–¥ –≤ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é –∑–∞–Ω–∏–º–∞—é—Ç –≤—Å–µ–≥–æ 10 –¥–Ω–µ–π. –ö–æ–º–ø–ª–µ–∫—Å –ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –±–ª–∞–≥–æ–¥–∞—Ä—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–º –≥–∞–±–∞—Ä–∏—Ç–∞–º.',
    features: [
      '–°–±–æ—Ä–∫–∞ –∏ –≤–≤–æ–¥ –≤ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é –∑–∞ 10 –¥–Ω–µ–π',
      '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã –±–ª–æ–∫–æ–≤',
      '–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–∏–ª–æ—Å—ã –º–∏–Ω–µ—Ä–∞–ª—å–Ω–æ–≥–æ –ø–æ—Ä–æ—à–∫–∞ –¥–æ 80 —Ç',
      '–£–¥–∞–ª—ë–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7'
    ],
    images: [
      'https://images.unsplash.com/photo-1581094794329-c8112a89af12?w=1200&h=800&fit=crop',
      'https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=1200&h=800&fit=crop',
      'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=1200&h=800&fit=crop'
    ]
  },
  {
    id: 'apexmobile-160',
    name: 'ApexMobile 160',
    capacity: 160,
    capacityCategory: 'low',
    type: '–ú–æ–±–∏–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞',
    description:
      '–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –º–æ–±–∏–ª—å–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ —Ä–µ–º–æ–Ω—Ç–∞ –¥–æ—Ä–æ–≥ –≤ —Ç—Ä—É–¥–Ω–æ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö.',
    fullDescription:
      'ApexMobile 160 ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –º–æ–±–∏–ª—å–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é 160 —Ç–æ–Ω–Ω –≤ —á–∞—Å. –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ —Ä–µ–º–æ–Ω—Ç–∞ –¥–æ—Ä–æ–≥ –≤ —Ç—Ä—É–¥–Ω–æ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ –ø–ª–æ—â–∞–¥–∫–µ –∑–∞–Ω–∏–º–∞–µ—Ç –º–µ–Ω–µ–µ 72 —á–∞—Å–æ–≤. –£—Å–∏–ª–µ–Ω–Ω–∞—è —Ä–∞–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–ª–µ–∫—Å –ø—Ä–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ –¥–æ -45¬∞C.',
    features: [
      '–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ –ø–ª–æ—â–∞–¥–∫–µ –º–µ–Ω–µ–µ —á–µ–º –∑–∞ 72 —á–∞—Å–∞',
      '–≠–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –¥–∏–∑–µ–ª—å–Ω–∞—è –≥–æ—Ä–µ–ª–∫–∞',
      '–£—Å–∏–ª–µ–Ω–Ω–∞—è —Ä–∞–º–∞ –¥–ª—è —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ –≤ -45 ¬∞C',
      '–ö–æ–º–ø–ª–µ–∫—Ç —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –∏ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è'
    ],
    includes: [
      { icon: 'üöö', text: '–ú–æ–±–∏–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞' },
      { icon: '‚öôÔ∏è', text: '–°—É—à–∏–ª—å–Ω—ã–π –±–∞—Ä–∞–±–∞–Ω' },
      { icon: 'üìä', text: '–°–∏—Å—Ç–µ–º–∞ –¥–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è' },
      { icon: 'üî•', text: '–î–∏–∑–µ–ª—å–Ω–∞—è –≥–æ—Ä–µ–ª–∫–∞' },
      { icon: 'üåø', text: '–°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏' },
      { icon: 'üíª', text: '–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏' }
    ],
    specs: [
      { label: '–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å', value: '160 —Ç/—á' },
      { label: '–ú–æ—â–Ω–æ—Å—Ç—å –≥–æ—Ä–µ–ª–∫–∏', value: '12 –ú–í—Ç' },
      { label: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Å—É—à–∫–∏', value: '–¥–æ 180¬∞C' },
      { label: '–≠–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ', value: '280 –∫–í—Ç' },
      { label: '–ü–ª–æ—â–∞–¥—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏', value: '32√ó18 –º' },
      { label: '–í–µ—Å', value: '180 —Ç' }
    ],
    pdfSpec: '#',
    images: [
      'https://images.unsplash.com/photo-1581094794329-c8112a89af12?w=1200&h=800&fit=crop',
      'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=1200&h=800&fit=crop',
      'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=1200&h=800&fit=crop'
    ]
  },
  {
    id: 'apexeco-260',
    name: 'ApexEco 260',
    capacity: 260,
    capacityCategory: 'medium',
    type: '–°—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å',
    description:
      '–≠–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å —Å —Ä–µ–∫—É–ø–µ—Ä–∞—Ü–∏–µ–π —Ç–µ–ø–ª–∞ –∏ —Å–Ω–∏–∂–µ–Ω–Ω—ã–º –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ–º —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏ –¥–æ 18%.',
    fullDescription:
      'ApexEco 260 ‚Äî —ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é 260 —Ç–æ–Ω–Ω –≤ —á–∞—Å. –ú–æ–¥–µ–ª—å –æ—Å–Ω–∞—â–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–æ–π —Ä–µ–∫—É–ø–µ—Ä–∞—Ü–∏–∏ —Ç–µ–ø–ª–∞ —Å—É—à–∏–ª—å–Ω–æ–≥–æ –±–∞—Ä–∞–±–∞–Ω–∞, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–Ω–∏–∑–∏—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏ –¥–æ 18%. –ó–∞–º–∫–Ω—É—Ç—ã–π —Ü–∏–∫–ª –ø—ã–ª–µ—É–ª–∞–≤–ª–∏–≤–∞–Ω–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —ç–∫–æ–ª–æ–≥–∏—á–Ω–æ—Å—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞.',
    features: [
      '–ó–∞–º–∫–Ω—É—Ç—ã–π —Ü–∏–∫–ª –ø—ã–ª–µ—É–ª–∞–≤–ª–∏–≤–∞–Ω–∏—è',
      '–†–µ–∫—É–ø–µ—Ä–∞—Ü–∏—è —Ç–µ–ø–ª–∞ —Å—É—à–∏–ª—å–Ω–æ–≥–æ –±–∞—Ä–∞–±–∞–Ω–∞',
      '–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞',
      '–û–ø—Ü–∏—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –†–ê–ü –¥–æ 40 %'
    ],
    includes: [
      { icon: '‚öôÔ∏è', text: '–°—É—à–∏–ª—å–Ω—ã–π –±–∞—Ä–∞–±–∞–Ω —Å —Ä–µ–∫—É–ø–µ—Ä–∞—Ü–∏–µ–π' },
      { icon: 'üìä', text: '–°–∏—Å—Ç–µ–º–∞ –¥–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è' },
      { icon: 'üî•', text: '–≠–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –≥–æ—Ä–µ–ª–∫–∞' },
      { icon: 'üåø', text: '–ó–∞–º–∫–Ω—É—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏' },
      { icon: 'üíª', text: '–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞' },
      { icon: '‚ôªÔ∏è', text: '–°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –†–ê–ü' }
    ],
    specs: [
      { label: '–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å', value: '260 —Ç/—á' },
      { label: '–ú–æ—â–Ω–æ—Å—Ç—å –≥–æ—Ä–µ–ª–∫–∏', value: '20 –ú–í—Ç' },
      { label: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Å—É—à–∫–∏', value: '–¥–æ 180¬∞C' },
      { label: '–≠–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ', value: '380 –∫–í—Ç' },
      { label: '–ü–ª–æ—â–∞–¥—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏', value: '42√ó24 –º' },
      { label: '–í–µ—Å', value: '250 —Ç' }
    ],
    pdfSpec: '#',
    images: [
      'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=1200&h=800&fit=crop',
      'https://images.unsplash.com/photo-1581094794329-c8112a89af12?w=1200&h=800&fit=crop',
      'https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=1200&h=800&fit=crop'
    ]
  },
  {
    id: 'apexmicro-140',
    name: 'ApexMicro 140',
    capacity: 140,
    capacityCategory: 'low',
    type: '–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å',
    description:
      '–†–µ—à–µ–Ω–∏–µ –¥–ª—è –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã—Ö –ø–æ–¥—Ä—è–¥—á–∏–∫–æ–≤ –∏ –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤ —Å —É–ø–æ—Ä–æ–º –Ω–∞ –±–µ–∑–æ—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–π —Ü–∏–∫–ª.',
    fullDescription:
      'ApexMicro 140 ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é 140 —Ç–æ–Ω–Ω –≤ —á–∞—Å. –ò–¥–µ–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã—Ö –ø–æ–¥—Ä—è–¥—á–∏–∫–æ–≤ –∏ –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤. –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ –∏ –ø–æ–Ω–∏–∂–µ–Ω–Ω–æ–µ —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –¥–µ–ª–∞—é—Ç –µ–≥–æ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏ –≤—ã–≥–æ–¥–Ω—ã–º –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤.',
    features: [
      '–ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ –∏ –ø–æ–Ω–∏–∂–µ–Ω–Ω–æ–µ —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ',
      '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–µ–¥–µ–Ω–∏–µ –∂—É—Ä–Ω–∞–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π',
      '–û–ø—Ü–∏—è –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤–∞–Ω–∏—è —Å–∏–ª–æ—Å–æ–º –º–∏–Ω–µ—Ä–∞–ª–æ–≤ 40 —Ç',
      '–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏—Å—Ç–∏–∫–∞ –∏ –º–æ–Ω—Ç–∞–∂'
    ],
    includes: [
      { icon: '‚öôÔ∏è', text: '–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Å—É—à–∏–ª—å–Ω—ã–π –±–∞—Ä–∞–±–∞–Ω' },
      { icon: 'üìä', text: '–°–∏—Å—Ç–µ–º–∞ –¥–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è' },
      { icon: 'üî•', text: '–ì–∞–∑–æ–≤–∞—è –≥–æ—Ä–µ–ª–∫–∞' },
      { icon: 'üåø', text: '–°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏' },
      { icon: 'üíª', text: '–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è' },
      { icon: 'üì¶', text: '–°–∏–ª–æ—Å –º–∏–Ω–µ—Ä–∞–ª—å–Ω–æ–≥–æ –ø–æ—Ä–æ—à–∫–∞ 40 —Ç' }
    ],
    specs: [
      { label: '–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å', value: '140 —Ç/—á' },
      { label: '–ú–æ—â–Ω–æ—Å—Ç—å –≥–æ—Ä–µ–ª–∫–∏', value: '10 –ú–í—Ç' },
      { label: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Å—É—à–∫–∏', value: '–¥–æ 180¬∞C' },
      { label: '–≠–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ', value: '240 –∫–í—Ç' },
      { label: '–ü–ª–æ—â–∞–¥—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏', value: '30√ó16 –º' },
      { label: '–í–µ—Å', value: '150 —Ç' }
    ],
    pdfSpec: '#',
    images: [
      'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=1200&h=800&fit=crop',
      'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=1200&h=800&fit=crop',
      'https://images.unsplash.com/photo-1581094794329-c8112a89af12?w=1200&h=800&fit=crop'
    ]
  },
  {
    id: 'apexpro-400',
    name: 'ApexPro 400',
    capacity: 400,
    capacityCategory: 'high',
    type: '–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å',
    badges: [{ type: 'top', text: '–¢–æ–ø –ø—Ä–æ–¥–∞–∂–∞' }, { type: 'new', text: '–ù–æ–≤–∏–Ω–∫–∞' }],
    description:
      '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —É–∑–ª–æ–≤ –∏ –¥–≤–æ–π–Ω—ã–µ —Ü–∏–∫–ª—ã.',
    fullDescription:
      'ApexPro 400 ‚Äî –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é 400 —Ç–æ–Ω–Ω –≤ —á–∞—Å. –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –∫—Ä—É–ø–Ω—ã—Ö –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤. –î–≤–æ–π–Ω–æ–π —Å–º–µ—Å–∏—Ç–µ–ª—å–Ω—ã–π —É–∑–µ–ª –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ, –∞ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —É–∑–ª–æ–≤ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã.',
    features: [
      '–î–≤–æ–π–Ω–æ–π —Å–º–µ—Å–∏—Ç–µ–ª—å–Ω—ã–π —É–∑–µ–ª',
      '–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–¥–∞—á–∏ –¥–æ–±–∞–≤–æ–∫ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤',
      '–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ —Å–º–µ—Å–∏',
      '–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ü–µ–Ω—Ç—Ä –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏'
    ],
    images: [
      'https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=1200&h=800&fit=crop',
      'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=1200&h=800&fit=crop',
      'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=1200&h=800&fit=crop'
    ]
  }
];

const state = {
  selectedProductId: null
};

const catalogGrid = document.querySelector('[data-catalog-grid]');
const capacityFilter = document.querySelector('#capacity-filter');
const toast = document.querySelector('#toast');
const form = document.querySelector('#inquiry-form');
const consent = document.querySelector('#consent');
const phoneInput = document.querySelector('#phone');
const navbarToggle = document.querySelector('.navbar-toggle');
const navbarLinks = document.querySelector('.navbar-links');

const selectedProductInput = document.querySelector('#productId');
const selectedProductInputModal = document.querySelector('#productId-modal');

// –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ–¥—É–∫—Ç–∞
const productModal = document.querySelector('#product-modal');
const modalOverlay = document.querySelector('.modal-overlay');
const modalClose = document.querySelector('.modal-close');
const galleryMain = document.querySelector('#gallery-main');
const galleryThumbnails = document.querySelector('#gallery-thumbnails');
const galleryPrev = document.querySelector('.gallery-prev');
const galleryNext = document.querySelector('.gallery-next');
const modalContactBtn = document.querySelector('#modal-contact-btn');

// –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ñ–æ—Ä–º—ã
const contactModal = document.querySelector('#contact-modal');
const contactModalOverlay = document.querySelector('.contact-modal-overlay');
const contactModalClose = document.querySelector('.contact-modal-close');
const contactFormModal = document.querySelector('#inquiry-form-modal');
const phoneInputModal = document.querySelector('#phone-modal');
const consentModal = document.querySelector('#consent-modal');

let currentGalleryIndex = 0;
let currentProductImages = [];
let previousContactFocusElement = null;

function createFeatureList(features) {
  const list = document.createElement('ul');
  list.className = 'feature-list';

  features.forEach((feature) => {
    const item = document.createElement('li');
    item.textContent = feature;
    list.appendChild(item);
  });

  return list;
}

function createMetaRow(product) {
  const wrapper = document.createElement('div');
  wrapper.className = 'product-meta';

  const capacityTag = document.createElement('span');
  capacityTag.textContent = `${product.capacity} —Ç/—á`;
  wrapper.appendChild(capacityTag);

  const typeTag = document.createElement('span');
  typeTag.textContent = product.type;
  wrapper.appendChild(typeTag);

  return wrapper;
}

function createProductCard(product) {
  const card = document.createElement('article');
  card.className = 'product-card';
  card.dataset.productId = product.id;
  card.setAttribute('tabindex', '0');
  card.setAttribute('role', 'button');
  card.setAttribute('aria-label', `–û—Ç–∫—Ä—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ ${product.name}`);
  card.setAttribute('aria-describedby', `product-${product.id}-desc`);

  // –ë–µ–π–¥–∂–∏
  if (product.badges && product.badges.length > 0) {
    const badgesContainer = document.createElement('div');
    badgesContainer.className = 'product-badges';
    product.badges.forEach((badge) => {
      const badgeEl = document.createElement('span');
      badgeEl.className = `product-badge product-badge-${badge.type}`;
      badgeEl.textContent = badge.text;
      badgesContainer.appendChild(badgeEl);
    });
    card.appendChild(badgesContainer);
  }

  // –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  if (product.images && product.images.length > 0) {
    const previewWrapper = document.createElement('div');
    previewWrapper.className = 'product-preview';
    const previewImg = document.createElement('img');
    previewImg.src = product.images[0];
    previewImg.alt = `${product.name} - –ø—Ä–µ–≤—å—é`;
    previewImg.loading = 'lazy';
    previewWrapper.appendChild(previewImg);
    card.appendChild(previewWrapper);
  }

  const title = document.createElement('h3');
  title.textContent = product.name;

  const description = document.createElement('p');
  description.textContent = product.description;
  description.id = `product-${product.id}-desc`;

  card.appendChild(title);
  card.appendChild(createMetaRow(product));
  card.appendChild(description);
  card.appendChild(createFeatureList(product.features));

  // CTA –∫–Ω–æ–ø–∫–∞
  const ctaButton = document.createElement('button');
  ctaButton.className = 'product-card-cta';
  ctaButton.type = 'button';
  ctaButton.textContent = '–ü–æ–¥—Ä–æ–±–Ω–µ–µ';
  ctaButton.setAttribute('aria-label', `–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ ${product.name}`);
  card.appendChild(ctaButton);

  // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–í—ã–±—Ä–∞–Ω–æ"
  const selectedIndicator = document.createElement('div');
  selectedIndicator.className = 'product-selected-indicator';
  selectedIndicator.textContent = '–í—ã–±—Ä–∞–Ω–æ';
  selectedIndicator.setAttribute('aria-hidden', 'true');
  card.appendChild(selectedIndicator);

  const handleActivate = () => {
    // –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–∏—Ä–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç –≤ —Ñ–æ—Ä–º–µ
    selectProduct(product.id);
    // –ó–∞—Ç–µ–º –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    openProductModal(product.id);
  };

  card.addEventListener('click', (event) => {
    // –ù–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ CTA, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞
    if (event.target === ctaButton || ctaButton.contains(event.target)) {
      return;
    }
    handleActivate();
  });

  ctaButton.addEventListener('click', (event) => {
    event.stopPropagation();
    handleActivate();
  });

  card.addEventListener('keydown', (event) => {
    if (event.key === 'Enter' || event.key === ' ') {
      event.preventDefault();
      handleActivate();
    }
  });

  return card;
}

function renderProducts(filterValue = 'all') {
  catalogGrid.innerHTML = '';

  const filteredProducts =
    filterValue === 'all'
      ? products
      : products.filter((product) => product.capacityCategory === filterValue);

  filteredProducts.forEach((product) => {
    const card = createProductCard(product);
    catalogGrid.appendChild(card);
  });

  // –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –±—ã–ª —è–≤–Ω–æ –≤—ã–±—Ä–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
  if (state.selectedProductId) {
    const selectedProduct = filteredProducts.find((p) => p.id === state.selectedProductId);
    if (selectedProduct) {
      selectProduct(state.selectedProductId);
    } else {
      // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç –Ω–µ –≤ —Ñ–∏–ª—å—Ç—Ä–µ, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
      selectProduct(null);
    }
  }

  if (!filteredProducts.length) {
    const empty = document.createElement('div');
    empty.className = 'product-empty';
    empty.textContent = '–ù–µ—Ç —Ä–µ—à–µ–Ω–∏–π –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä.';
    catalogGrid.appendChild(empty);
  }
}

function populateProductSelects() {
  // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π select
  if (selectedProductInput && selectedProductInput.tagName === 'SELECT') {
    // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–ø—Ü–∏–∏ (–∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–π –ø—É—Å—Ç–æ–π)
    while (selectedProductInput.options.length > 1) {
      selectedProductInput.remove(1);
    }
    products.forEach((product) => {
      const option = document.createElement('option');
      option.value = product.id;
      option.textContent = `${product.name} (${product.capacity} —Ç/—á)`;
      selectedProductInput.appendChild(option);
    });
  }

  // –ó–∞–ø–æ–ª–Ω—è–µ–º –º–æ–¥–∞–ª—å–Ω—ã–π select
  if (selectedProductInputModal && selectedProductInputModal.tagName === 'SELECT') {
    // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–ø—Ü–∏–∏ (–∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–π –ø—É—Å—Ç–æ–π)
    while (selectedProductInputModal.options.length > 1) {
      selectedProductInputModal.remove(1);
    }
    products.forEach((product) => {
      const option = document.createElement('option');
      option.value = product.id;
      option.textContent = `${product.name} (${product.capacity} —Ç/—á)`;
      selectedProductInputModal.appendChild(option);
    });
  }
}

function selectProduct(productId, options = {}) {
  if (!productId) {
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –≤ –æ–±–µ–∏—Ö —Ñ–æ—Ä–º–∞—Ö
    if (selectedProductInput) {
      selectedProductInput.value = '';
    }
    
    if (selectedProductInputModal) {
      selectedProductInputModal.value = '';
    }
    
    // –£–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–í—ã–±—Ä–∞–Ω–æ" —Å–æ –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
    document.querySelectorAll('.product-selected-indicator').forEach((indicator) => {
      indicator.style.display = 'none';
    });
    
    document.querySelectorAll('.product-card').forEach((card) => {
      card.classList.remove('active');
    });
    
    state.selectedProductId = null;
    return;
  }
  
  const { scroll = false } = options;
  state.selectedProductId = productId;

  document.querySelectorAll('.product-card').forEach((card) => {
    const isActive = card.dataset.productId === productId;
    card.classList.toggle('active', isActive);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–í—ã–±—Ä–∞–Ω–æ"
    const selectedIndicator = card.querySelector('.product-selected-indicator');
    if (selectedIndicator) {
      selectedIndicator.style.display = isActive ? 'flex' : 'none';
    }
    
    if (isActive && scroll) {
      card.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  });

  const product = products.find((item) => item.id === productId);
  if (!product) {
    return;
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º select –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º–µ
  if (selectedProductInput) {
    if (selectedProductInput.tagName === 'SELECT') {
      selectedProductInput.value = product.id;
    } else {
      selectedProductInput.value = product.id;
    }
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º select –≤ –º–æ–¥–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º–µ
  if (selectedProductInputModal) {
    if (selectedProductInputModal.tagName === 'SELECT') {
      selectedProductInputModal.value = product.id;
    } else {
      selectedProductInputModal.value = product.id;
    }
  }
}

function showToast(message, type = 'success') {
  toast.textContent = message;
  toast.className = `toast ${type}`;
  requestAnimationFrame(() => {
    toast.classList.add('visible');
  });
  setTimeout(() => {
    toast.classList.remove('visible');
  }, 4200);
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
let previousFocusElement = null;

function openProductModal(productId) {
  const product = products.find((p) => p.id === productId);
  if (!product || !productModal) return;

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —ç–ª–µ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–∫—Ä—ã–ª –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
  previousFocusElement = document.activeElement;

  currentProductImages = product.images || [];
  currentGalleryIndex = 0;

  // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–¥—É–∫—Ç–µ
  document.querySelector('#modal-title').textContent = product.name;
  document.querySelector('#modal-description').textContent = product.fullDescription || product.description;
  
  const modalMeta = document.querySelector('#modal-meta');
  modalMeta.innerHTML = '';
  const metaRow = createMetaRow(product);
  modalMeta.appendChild(metaRow);

  // –ó–∞–ø–æ–ª–Ω—è–µ–º "–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ –∫–æ–º–ø–ª–µ–∫—Å"
  const includesGrid = document.querySelector('#includes-grid');
  const modalIncludes = document.querySelector('#modal-includes');
  if (product.includes && product.includes.length > 0) {
    includesGrid.innerHTML = '';
    product.includes.forEach((item) => {
      const includeItem = document.createElement('div');
      includeItem.className = 'include-item';
      includeItem.innerHTML = `
        <span class="include-icon">${item.icon}</span>
        <span class="include-text">${item.text}</span>
      `;
      includesGrid.appendChild(includeItem);
    });
    modalIncludes.style.display = 'block';
  } else {
    modalIncludes.style.display = 'none';
  }

  // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  const specsTbody = document.querySelector('#specs-tbody');
  const modalSpecs = document.querySelector('#modal-specs');
  if (product.specs && product.specs.length > 0) {
    specsTbody.innerHTML = '';
    product.specs.forEach((spec) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td class="spec-label">${spec.label}</td>
        <td class="spec-value">${spec.value}</td>
      `;
      specsTbody.appendChild(row);
    });
    modalSpecs.style.display = 'block';
  } else {
    modalSpecs.style.display = 'none';
  }

  // –°—Å—ã–ª–∫–∞ –Ω–∞ PDF
  const pdfLink = document.querySelector('#modal-pdf-link');
  if (product.pdfSpec && product.pdfSpec !== '#') {
    pdfLink.href = product.pdfSpec;
    pdfLink.style.display = 'inline-flex';
  } else {
    pdfLink.style.display = 'none';
  }

  const modalFeatures = document.querySelector('#modal-features');
  modalFeatures.innerHTML = '';
  const featuresList = createFeatureList(product.features);
  featuresList.className = 'modal-features-list';
  modalFeatures.appendChild(featuresList);

  // –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç –≤ —Ñ–æ—Ä–º–µ
  selectProduct(productId);

  // –û–±–Ω–æ–≤–ª—è–µ–º –≥–∞–ª–µ—Ä–µ—é
  updateGallery();

  // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
  productModal.setAttribute('aria-hidden', 'false');
  productModal.setAttribute('aria-modal', 'true');
  productModal.classList.add('is-open');
  document.body.style.overflow = 'hidden';

  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º focus trap
  setupFocusTrap();

  // –§–æ–∫—É—Å –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
  modalClose?.focus();
}

function closeProductModal() {
  if (!productModal) return;
  productModal.setAttribute('aria-hidden', 'true');
  productModal.removeAttribute('aria-modal');
  productModal.classList.remove('is-open');
  document.body.style.overflow = '';
  
  // –£–¥–∞–ª—è–µ–º focus trap
  removeFocusTrap();

  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–æ–∫—É—Å –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–∫—Ä—ã–ª –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
  if (previousFocusElement) {
    previousFocusElement.focus();
    previousFocusElement = null;
  }
}

function setupFocusTrap() {
  const focusableElements = productModal.querySelectorAll(
    'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
  );
  const firstElement = focusableElements[0];
  const lastElement = focusableElements[focusableElements.length - 1];

  const handleTabKey = (event) => {
    if (event.key !== 'Tab') return;
    
    if (event.shiftKey) {
      if (document.activeElement === firstElement) {
        event.preventDefault();
        lastElement?.focus();
      }
    } else {
      if (document.activeElement === lastElement) {
        event.preventDefault();
        firstElement?.focus();
      }
    }
  };

  productModal.addEventListener('keydown', handleTabKey);
  productModal._focusTrapHandler = handleTabKey;
}

function removeFocusTrap() {
  if (productModal._focusTrapHandler) {
    productModal.removeEventListener('keydown', productModal._focusTrapHandler);
    productModal._focusTrapHandler = null;
  }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ñ–æ—Ä–º—ã
function openContactModal() {
  if (!contactModal) return;
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —ç–ª–µ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–∫—Ä—ã–ª –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
  previousContactFocusElement = document.activeElement;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º select –≤ –º–æ–¥–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º–µ, –µ—Å–ª–∏ –ø—Ä–æ–¥—É–∫—Ç —É–∂–µ –≤—ã–±—Ä–∞–Ω
  if (state.selectedProductId && selectedProductInputModal) {
    selectedProductInputModal.value = state.selectedProductId;
  }
  
  // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ñ–æ—Ä–º—ã (–ø–æ–≤–µ—Ä—Ö –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞)
  contactModal.setAttribute('aria-hidden', 'false');
  contactModal.setAttribute('aria-modal', 'true');
  contactModal.classList.add('is-open');
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º focus trap –¥–ª—è —Ñ–æ—Ä–º—ã
  setupContactFocusTrap();
  
  // –§–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–µ –ø–æ–ª–µ –∏–ª–∏ –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
  const firstInput = contactFormModal?.querySelector('input, textarea, button');
  if (firstInput) {
    setTimeout(() => firstInput.focus(), 100);
  } else {
    contactModalClose?.focus();
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–∞—Å–∫—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º—ã
  if (phoneInputModal) {
    if (!phoneInputModal.value.trim()) {
      phoneInputModal.value = '+7 ';
    }
  }
}

function closeContactModal() {
  if (!contactModal) return;
  
  contactModal.setAttribute('aria-hidden', 'true');
  contactModal.removeAttribute('aria-modal');
  contactModal.classList.remove('is-open');
  
  // –£–¥–∞–ª—è–µ–º focus trap
  removeContactFocusTrap();
  
  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–æ–∫—É—Å –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–∫—Ä—ã–ª –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
  if (previousContactFocusElement) {
    previousContactFocusElement.focus();
    previousContactFocusElement = null;
  }
}

function setupContactFocusTrap() {
  const focusableElements = contactModal.querySelectorAll(
    'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
  );
  const firstElement = focusableElements[0];
  const lastElement = focusableElements[focusableElements.length - 1];

  const handleTabKey = (event) => {
    if (event.key !== 'Tab') return;
    
    if (event.shiftKey) {
      if (document.activeElement === firstElement) {
        event.preventDefault();
        lastElement?.focus();
      }
    } else {
      if (document.activeElement === lastElement) {
        event.preventDefault();
        firstElement?.focus();
      }
    }
  };

  contactModal.addEventListener('keydown', handleTabKey);
  contactModal._focusTrapHandler = handleTabKey;
}

function removeContactFocusTrap() {
  if (contactModal._focusTrapHandler) {
    contactModal.removeEventListener('keydown', contactModal._focusTrapHandler);
    contactModal._focusTrapHandler = null;
  }
}

function updateGallery() {
  if (!galleryMain || !galleryThumbnails || currentProductImages.length === 0) return;

  // –û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
  galleryMain.innerHTML = '';
  const mainImg = document.createElement('img');
  mainImg.src = currentProductImages[currentGalleryIndex];
  mainImg.alt = `–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${currentGalleryIndex + 1}`;
  mainImg.className = 'gallery-main-image';
  galleryMain.appendChild(mainImg);

  // –ú–∏–Ω–∏–∞—Ç—é—Ä—ã
  galleryThumbnails.innerHTML = '';
  currentProductImages.forEach((imgSrc, index) => {
    const thumb = document.createElement('button');
    thumb.className = `gallery-thumb ${index === currentGalleryIndex ? 'active' : ''}`;
    thumb.type = 'button';
    thumb.setAttribute('aria-label', `–ü–æ–∫–∞–∑–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${index + 1}`);
    const thumbImg = document.createElement('img');
    thumbImg.src = imgSrc;
    thumbImg.alt = `–ú–∏–Ω–∏–∞—Ç—é—Ä–∞ ${index + 1}`;
    thumb.appendChild(thumbImg);
    thumb.addEventListener('click', () => {
      currentGalleryIndex = index;
      updateGallery();
    });
    galleryThumbnails.appendChild(thumb);
  });

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
  if (galleryPrev && galleryNext) {
    galleryPrev.style.display = currentProductImages.length > 1 ? 'flex' : 'none';
    galleryNext.style.display = currentProductImages.length > 1 ? 'flex' : 'none';
  }
}

function navigateGallery(direction) {
  if (currentProductImages.length === 0) return;
  if (direction === 'next') {
    currentGalleryIndex = (currentGalleryIndex + 1) % currentProductImages.length;
  } else {
    currentGalleryIndex = currentGalleryIndex === 0 ? currentProductImages.length - 1 : currentGalleryIndex - 1;
  }
  updateGallery();
}

async function handleSubmit(event) {
  event.preventDefault();

  const submitBtn = document.querySelector('#submit-btn');
  const submitText = submitBtn?.querySelector('.submit-text');
  const submitSpinner = submitBtn?.querySelector('.submit-spinner');
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏
  if (submitBtn) {
    submitBtn.disabled = true;
    if (submitText) submitText.style.display = 'none';
    if (submitSpinner) submitSpinner.style.display = 'inline-flex';
  }

  const formData = new FormData(form);

  // Honeypot: silently drop
  if (formData.get('website')) {
    return;
  }

  if (consent && !consent.checked) {
    showToast('–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.', 'error');
    consent.focus();
    return;
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
  const name = formData.get('name')?.trim() || '';
  if (!name || name.length < 2) {
    showToast('–£–∫–∞–∂–∏—Ç–µ –∏–º—è –∏ –∫–æ–º–ø–∞–Ω–∏—é (–Ω–µ –º–µ–Ω–µ–µ 2 —Å–∏–º–≤–æ–ª–æ–≤).', 'error');
    document.querySelector('#name')?.focus();
    return;
  }

  const rawPhone = String(formData.get('phone') || '').trim();
  const phoneDigits = rawPhone.replace(/\D+/g, '');
  const isValidPhone = phoneDigits.length >= 11 && (phoneDigits.startsWith('7') || phoneDigits.startsWith('8'));

  const payload = {
    name: name,
    phone: rawPhone,
    email: formData.get('email')?.trim(),
    productId: formData.get('productId')?.trim(),
    message: formData.get('message')?.trim()
  };

  if (!payload.productId) {
    showToast('–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–ª–µ–∫—Å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∑–∞—è–≤–∫–∏.', 'error');
    return;
  }

  if (!isValidPhone) {
    showToast('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ +7 (___) ___-__-__', 'error');
    phoneInput?.focus();
    return;
  }

  try {
    const response = await fetch('/api/inquiry', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    });

    const result = await response.json();

    if (!response.ok) {
      throw new Error(result.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É');
    }

    showToast(result.message || '–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞', 'success');
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ñ–æ—Ä–º—ã, –µ—Å–ª–∏ –æ–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ
    if (contactModal && contactModal.classList.contains('is-open')) {
      closeContactModal();
    }
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
    form.reset();
    if (contactFormModal) {
      contactFormModal.reset();
    }
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç
    if (payload.productId) {
      selectedProductInput.value = payload.productId;
      if (document.querySelector('#productId-modal')) {
        document.querySelector('#productId-modal').value = payload.productId;
      }
    }
  } catch (error) {
    showToast(
      error.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É –ø–æ–∑–∂–µ.',
      'error'
    );
  } finally {
    // –£–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏
    if (submitBtn) {
      submitBtn.disabled = false;
      if (submitText) submitText.style.display = 'inline';
      if (submitSpinner) submitSpinner.style.display = 'none';
    }
  }
}

function setupRevealAnimations() {
  const targets = document.querySelectorAll('[data-animate]');
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          observer.unobserve(entry.target);
        }
      });
    },
    {
      threshold: 0.2,
      rootMargin: '0px 0px -10% 0px'
    }
  );

  targets.forEach((target) => observer.observe(target));
}

function setupNavbar() {
  if (!navbarToggle || !navbarLinks) {
    return;
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è aria-hidden –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞
  const updateNavbarAccessibility = () => {
    const isMobile = window.matchMedia('(max-width: 768px)').matches;
    if (isMobile) {
      // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö: aria-hidden –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–Ω—é
      if (!navbarLinks.classList.contains('is-open')) {
        navbarLinks.setAttribute('aria-hidden', 'true');
      }
    } else {
      // –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ: –º–µ–Ω—é –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º–æ –¥–ª—è —Å–∫—Ä–∏–Ω—Ä–∏–¥–µ—Ä–æ–≤
      navbarLinks.removeAttribute('aria-hidden');
    }
  };

  // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
  updateNavbarAccessibility();
  window.addEventListener('resize', updateNavbarAccessibility);

  const firstMenuLink = navbarLinks.querySelector('a');
  const closeMenu = () => {
    navbarLinks.classList.remove('is-open');
    navbarLinks.setAttribute('aria-hidden', 'true');
    navbarToggle.setAttribute('aria-expanded', 'false');
    navbarToggle.focus();
    document.removeEventListener('keydown', onKeydown);
    document.removeEventListener('click', onOutsideClick, true);
  };

  const openMenu = () => {
    navbarLinks.classList.add('is-open');
    navbarLinks.setAttribute('aria-hidden', 'false');
    navbarToggle.setAttribute('aria-expanded', 'true');
    if (firstMenuLink) {
      firstMenuLink.focus();
    }
    document.addEventListener('keydown', onKeydown);
    document.addEventListener('click', onOutsideClick, true);
  };

  const onKeydown = (event) => {
    if (event.key === 'Escape') {
      closeMenu();
    }
  };

  const onOutsideClick = (event) => {
    if (!navbarLinks.contains(event.target) && event.target !== navbarToggle) {
      closeMenu();
    }
  };

  navbarToggle.addEventListener('click', () => {
    const isOpen = navbarLinks.classList.contains('is-open');
    if (isOpen) {
      closeMenu();
    } else {
      openMenu();
    }
  });

  navbarLinks.querySelectorAll('a').forEach((link) => {
    link.addEventListener('click', () => {
      closeMenu();
    });
  });
}

function setupSmoothAnchors() {
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
  const updateActiveSection = () => {
    const sections = document.querySelectorAll('section[id], header[id]');
    const navLinks = document.querySelectorAll('.navbar-links a[href^="#"]');
    
    let currentSection = '';
    sections.forEach((section) => {
      const sectionTop = section.offsetTop - 100;
      const sectionHeight = section.offsetHeight;
      if (window.scrollY >= sectionTop && window.scrollY < sectionTop + sectionHeight) {
        currentSection = section.getAttribute('id');
      }
    });

    navLinks.forEach((link) => {
      const href = link.getAttribute('href').replace('#', '');
      link.classList.toggle('active', href === currentSection);
    });
  };

  // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
  window.addEventListener('scroll', updateActiveSection);
  updateActiveSection(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

  document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener('click', (event) => {
      // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º skip-link - —Ä–∞–∑—Ä–µ—à–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
      if (anchor.classList.contains('skip-link')) {
        const target = document.querySelector(anchor.getAttribute('href'));
        if (target) {
          // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Ñ–æ–∫—É—Å –Ω–∞ —Ü–µ–ª—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞
          setTimeout(() => {
            target.setAttribute('tabindex', '-1');
            target.focus();
            target.removeAttribute('tabindex');
          }, 100);
        }
        return; // –†–∞–∑—Ä–µ—à–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞
      }
      
      const target = document.querySelector(anchor.getAttribute('href'));
      if (!target) {
        return;
      }
      event.preventDefault();
      target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–¥–µ–ª –ø–æ—Å–ª–µ —Å–∫—Ä–æ–ª–ª–∞
      setTimeout(updateActiveSection, 300);
    });
  });
}

function init() {
  renderProducts();
  populateProductSelects(); // –ó–∞–ø–æ–ª–Ω—è–µ–º select —Å–ø–∏—Å–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏
  // –ù–µ –≤—ã–±–∏—Ä–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —Å–¥–µ–ª–∞—Ç—å –≤—ã–±–æ—Ä —è–≤–Ω–æ
  // selectProduct(products[0].id);
  setupRevealAnimations();
  setupNavbar();
  setupSmoothAnchors();

  capacityFilter?.addEventListener('change', (event) => {
    const value = event.target.value;
    renderProducts(value);
    
    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞
    capacityFilter?.querySelectorAll('option').forEach((option) => {
      option.classList.remove('selected');
    });
    const selectedOption = capacityFilter?.querySelector(`option[value="${value}"]`);
    if (selectedOption) {
      selectedOption.classList.add('selected');
    }
  });
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞
  if (capacityFilter) {
    const initialValue = capacityFilter.value || 'all';
    const initialOption = capacityFilter.querySelector(`option[value="${initialValue}"]`);
    if (initialOption) {
      initialOption.classList.add('selected');
    }
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è select –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º–µ
  if (selectedProductInput && selectedProductInput.tagName === 'SELECT') {
    selectedProductInput.addEventListener('change', (event) => {
      const productId = event.target.value;
      if (productId) {
        selectProduct(productId, { scroll: true });
      } else {
        selectProduct(null);
      }
    });
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è select –≤ –º–æ–¥–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º–µ
  if (selectedProductInputModal && selectedProductInputModal.tagName === 'SELECT') {
    selectedProductInputModal.addEventListener('change', (event) => {
      const productId = event.target.value;
      if (productId) {
        selectProduct(productId);
      } else {
        selectProduct(null);
      }
    });
  }

  form?.addEventListener('submit', handleSubmit);

  // Simple phone mask
  if (phoneInput) {
    // Prefill with +7 on load if empty
    if (!phoneInput.value.trim()) {
      phoneInput.value = '+7 ';
    }

    // Ensure +7 appears on focus if cleared
    phoneInput.addEventListener('focus', () => {
      if (!phoneInput.value.trim() || !phoneInput.value.trim().startsWith('+7')) {
        phoneInput.value = '+7 ';
      }
    });

    phoneInput.addEventListener('input', () => {
      let digits = phoneInput.value.replace(/\D+/g, '');
      if (digits.startsWith('8')) digits = '7' + digits.slice(1);
      if (!digits.startsWith('7')) digits = '7' + digits;
      const parts = ['+7'];
      if (digits.length > 1) {
        const a = digits.slice(1, 4);
        if (a) parts.push(` (${a}`);
        const b = digits.slice(4, 7);
        if (b) parts.push(`) ${b}`);
        const c = digits.slice(7, 9);
        if (c) parts.push(`-${c}`);
        const d = digits.slice(9, 11);
        if (d) parts.push(`-${d}`);
      }
      phoneInput.value = parts.join('');
    });
  }

  // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
  if (modalClose) {
    modalClose.addEventListener('click', closeProductModal);
  }
  if (modalOverlay) {
    modalOverlay.addEventListener('click', closeProductModal);
  }
  if (galleryPrev) {
    galleryPrev.addEventListener('click', () => navigateGallery('prev'));
  }
  if (galleryNext) {
    galleryNext.addEventListener('click', () => navigateGallery('next'));
  }

  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
      // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–Ω–∞—á–∞–ª–∞ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ñ–æ—Ä–º—ã, –µ—Å–ª–∏ –æ–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ
      if (contactModal?.classList.contains('is-open')) {
        closeContactModal();
      } else if (productModal?.classList.contains('is-open')) {
        closeProductModal();
      }
    }
  });

  // –ö–Ω–æ–ø–∫–∞ "–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É" –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –ø—Ä–æ–¥—É–∫—Ç–∞
  if (modalContactBtn) {
    modalContactBtn.addEventListener('click', () => {
      openContactModal();
    });
  }

  // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ñ–æ—Ä–º—ã
  if (contactModalClose) {
    contactModalClose.addEventListener('click', closeContactModal);
  }
  if (contactModalOverlay) {
    contactModalOverlay.addEventListener('click', closeContactModal);
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
  if (contactFormModal) {
    contactFormModal.addEventListener('submit', async (event) => {
      event.preventDefault();
      
      const formData = new FormData(contactFormModal);
      
      // Honeypot: silently drop
      if (formData.get('website')) {
        return;
      }

      if (consentModal && !consentModal.checked) {
        showToast('–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.', 'error');
        consentModal.focus();
        return;
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
      const name = formData.get('name')?.trim() || '';
      if (!name || name.length < 2) {
        showToast('–£–∫–∞–∂–∏—Ç–µ –∏–º—è –∏ –∫–æ–º–ø–∞–Ω–∏—é (–Ω–µ –º–µ–Ω–µ–µ 2 —Å–∏–º–≤–æ–ª–æ–≤).', 'error');
        document.querySelector('#name-modal')?.focus();
        return;
      }

      const rawPhone = String(formData.get('phone') || '').trim();
      const phoneDigits = rawPhone.replace(/\D+/g, '');
      const isValidPhone = phoneDigits.length >= 11 && (phoneDigits.startsWith('7') || phoneDigits.startsWith('8'));

      const payload = {
        name: name,
        phone: rawPhone,
        email: formData.get('email')?.trim(),
        productId: formData.get('productId')?.trim(),
        message: formData.get('message')?.trim()
      };

      if (!payload.productId) {
        showToast('–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–ª–µ–∫—Å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∑–∞—è–≤–∫–∏.', 'error');
        return;
      }

      if (!isValidPhone) {
        showToast('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ +7 (___) ___-__-__', 'error');
        phoneInputModal?.focus();
        return;
      }

      try {
        const response = await fetch('/api/inquiry', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });

        const result = await response.json();

        if (!response.ok) {
          throw new Error(result.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É');
        }

        showToast(result.message || '–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞', 'success');
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ñ–æ—Ä–º—ã
        closeContactModal();
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
        contactFormModal.reset();
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç
        if (payload.productId) {
          if (document.querySelector('#productId-modal')) {
            document.querySelector('#productId-modal').value = payload.productId;
          }
        }
      } catch (error) {
        showToast(
          error.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É –ø–æ–∑–∂–µ.',
          'error'
        );
      }
    });
  }

  // –ú–∞—Å–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º—ã
  if (phoneInputModal) {
    if (!phoneInputModal.value.trim()) {
      phoneInputModal.value = '+7 ';
    }

    phoneInputModal.addEventListener('focus', () => {
      if (!phoneInputModal.value.trim() || !phoneInputModal.value.trim().startsWith('+7')) {
        phoneInputModal.value = '+7 ';
      }
    });

    phoneInputModal.addEventListener('input', () => {
      let digits = phoneInputModal.value.replace(/\D+/g, '');
      if (digits.startsWith('8')) digits = '7' + digits.slice(1);
      if (!digits.startsWith('7')) digits = '7' + digits;
      const parts = ['+7'];
      if (digits.length > 1) {
        const a = digits.slice(1, 4);
        if (a) parts.push(` (${a}`);
        const b = digits.slice(4, 7);
        if (b) parts.push(`) ${b}`);
        const c = digits.slice(7, 9);
        if (c) parts.push(`-${c}`);
        const d = digits.slice(9, 11);
        if (d) parts.push(`-${d}`);
      }
      phoneInputModal.value = parts.join('');
    });
  }

}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫ JavaScript
window.addEventListener('error', (event) => {
  console.error('JS Error:', event.error);
  // –í production –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ—à–∏–±–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  if (window.toast && typeof showToast === 'function') {
    showToast('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 'error');
  }
});

window.addEventListener('unhandledrejection', (event) => {
  console.error('Unhandled Promise Rejection:', event.reason);
  if (window.toast && typeof showToast === 'function') {
    showToast('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö.', 'error');
  }
});

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker –¥–ª—è PWA (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Safari)
if ('serviceWorker' in navigator) {
  // Safari —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π SW
  window.addEventListener('load', () => {
    navigator.serviceWorker
      .register('./sw.js', {
        scope: './'
      })
      .then((registration) => {
        console.log('SW registered:', registration);
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –¥–ª—è Safari
        registration.addEventListener('updatefound', () => {
          const newWorker = registration.installing;
          if (newWorker) {
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                console.log('New SW available');
              }
            });
          }
        });
      })
      .catch((error) => {
        // Safari –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å SW –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö
        console.log('SW registration failed:', error);
      });
  });
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –¥–ª—è Safari
  let refreshing = false;
  navigator.serviceWorker.addEventListener('controllerchange', () => {
    if (!refreshing) {
      refreshing = true;
      window.location.reload();
    }
  });
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏
function setupEngagementFeatures() {
  // –ë–∞–Ω–Ω–µ—Ä –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
  const consultationBanner = document.querySelector('#consultation-banner');
  const consultationBannerClose = document.querySelector('.consultation-banner-close');
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–Ω–Ω–µ—Ä —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  setTimeout(() => {
    const wasShown = sessionStorage.getItem('consultation-banner-shown');
    if (!wasShown && consultationBanner) {
      consultationBanner.setAttribute('aria-hidden', 'false');
      consultationBanner.classList.add('is-visible');
      sessionStorage.setItem('consultation-banner-shown', 'true');
    }
  }, 5000);

  if (consultationBannerClose) {
    consultationBannerClose.addEventListener('click', () => {
      consultationBanner.setAttribute('aria-hidden', 'true');
      consultationBanner.classList.remove('is-visible');
    });
  }

  const consultationBannerBtn = document.querySelector('#consultation-banner-btn');
  if (consultationBannerBtn) {
    consultationBannerBtn.addEventListener('click', () => {
      consultationBanner.setAttribute('aria-hidden', 'true');
      consultationBanner.classList.remove('is-visible');
      openContactModal();
    });
  }

  // –ö–Ω–æ–ø–∫–∞ "–ù–∞–≤–µ—Ä—Ö"
  const backToTop = document.querySelector('#back-to-top');
  if (backToTop) {
    const handleScroll = () => {
      if (window.scrollY > 400) {
        backToTop.style.display = 'flex';
      } else {
        backToTop.style.display = 'none';
      }
    };

    window.addEventListener('scroll', handleScroll);
    handleScroll(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

    backToTop.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  }

  // –ß–∞—Ç-–≤–∏–¥–∂–µ—Ç
  const chatWidget = document.querySelector('#chat-widget');
  if (chatWidget) {
    chatWidget.addEventListener('click', () => {
      openContactModal();
    });
  }
}

document.addEventListener('DOMContentLoaded', () => {
  init();
  setupEngagementFeatures();
});
